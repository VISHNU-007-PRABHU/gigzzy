{"version":3,"sources":["component/Admin/Booking/OndemandInvoice.js"],"names":["C2B_CONTENT","React","lazy","payment_status","0","50","10","11","4","13","14","detectMobile","useMobileDetect","SEND_ACCEPT_MSG","gql","OndemandInvoice","state","currency_symbol","collapsed","booking","booking_user","booking_provider","booking_category","booking_status","payment_type","mpeas_payment_callback","base_price","extra_price","ctob_shotcode","ctob_billRef","fetch_booking","_id","client","query","GET_PARTICULAR_BOOKING","variables","fetchPolicy","then","result","console","log","current_booking_status","props","match","params","id","setState","data","message","get_booking_message","b_id","a","that","subscribe","JSON","parse","localStorage","getItem","booking_id","next","loading","error","send_accept_msg","this","className","isMobile","href","placement","title","type","style","fontSize","src","main","alt","booking_ref","booking_date","color","fallback","class","role","BusinessNumber","AmountNumber","Amount","name","total","service_fee","admin_fee","category_type","category_name","subCategory_name","email","phone_number","Component","withRouter"],"mappings":"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","file":"static/js/39.4156d673.chunk.js","sourcesContent":["\r\nimport React, { Suspense } from \"react\";\r\nimport { Icon, Tooltip, Tag } from \"antd\"\r\nimport 'antd/dist/antd.css';\r\nimport '../../../scss/template.scss';\r\nimport { client } from \"../../../apollo\";\r\nimport { withRouter } from \"react-router\";\r\nimport gql from 'graphql-tag';\r\nimport '../../../scss/template.scss';\r\nimport { GET_PARTICULAR_BOOKING } from '../../../graphql/User/booking';\r\nimport main from '../../../image/main.png';\r\nimport useMobileDetect from 'use-mobile-detect-hook';\r\n\r\nconst C2B_CONTENT = React.lazy(() => import('./C2B_CONTENT')); // Lazy-loaded\r\n\r\nconst payment_status = {\r\n    0: \"welcome Gizzy\",\r\n    50: \"waiting for payment confirmation\",\r\n    10: \"Base price paid\",\r\n    11: \"Booking canceled\",\r\n    4: \"Job started\",\r\n    13: \"Ongoing\",\r\n    14: \"Completed\"\r\n}\r\nconst detectMobile = useMobileDetect();\r\n\r\nconst SEND_ACCEPT_MSG = gql`\r\nsubscription SENDACCEPTMSG($_id:ID,$booking_id:ID){\r\n    send_accept_msg (_id:$_id,booking_id:$booking_id){\r\n      _id\r\n      status\r\n      booking_status\r\n      payment_type\r\n      mpeas_payment_callback\r\n      base_price(code:\"symbol\")\r\n      extra_price(code:\"symbol\")\r\n      ctob_shotcode\r\n      ctob_billRef\r\n    }\r\n}`\r\nclass OndemandInvoice extends React.Component {\r\n    state = {\r\n        currency_symbol: 'Ksh',\r\n        collapsed: false,\r\n        booking: [],\r\n        booking_user: [],\r\n        booking_provider: [],\r\n        booking_category: [],\r\n        booking_status: 0,\r\n        payment_type: \"\",\r\n        mpeas_payment_callback: false,\r\n        base_price: \"0.00\",\r\n        extra_price: \"0.00\",\r\n        ctob_shotcode: \"\",\r\n        ctob_billRef: \"\",\r\n\r\n    };\r\n\r\n    componentDidMount() {\r\n        if(this.props.match.params.id){\r\n            this.fetch_booking(this.props.match.params.id);\r\n        }\r\n    }\r\n\r\n    fetch_booking = (_id) => {\r\n        client.query({\r\n            query: GET_PARTICULAR_BOOKING,\r\n            variables: { _id },\r\n            fetchPolicy: 'no-cache',\r\n        }).then(result => {\r\n            console.log(result);\r\n            this.current_booking_status(this.props.match?.params?.id)\r\n            this.setState({\r\n                booking: result.data.booking,\r\n                booking_category: result.data.booking[0]?.booking_category,\r\n                booking_user: result.data.booking[0]?.booking_user,\r\n                booking_provider: result.data.booking[0]?.booking_provider,\r\n                message: result.data.booking[0]?.get_booking_message,\r\n                booking_status: result.data.booking[0]?.booking_status,\r\n                payment_type: result.data.booking[0]?.payment_type || \"\",\r\n                base_price: result.data.booking[0]?.base_price || \"\",\r\n                extra_price: result.data.booking[0]?.extra_price || \"\",\r\n                ctob_shotcode: result.data.booking[0]?.ctob_shotcode || \"\",\r\n                ctob_billRef: result.data.booking[0]?.ctob_billRef || \"\",\r\n                mpeas_payment_callback: result.data.booking[0]?.mpeas_payment_callback,\r\n            })\r\n        });\r\n    }\r\n\r\n    current_booking_status = async (b_id) => {\r\n        var that = this;\r\n        await client.subscribe({\r\n            query: SEND_ACCEPT_MSG,\r\n            variables: { _id: JSON.parse(localStorage.getItem('user'))._id, booking_id: b_id },\r\n        }).subscribe({\r\n            next(data, loading, error) {\r\n                if (loading) {\r\n                    console.log('load');\r\n                }\r\n                if (data) {\r\n                    console.log(data.data.send_accept_msg);\r\n                    that.setState({\r\n                        booking_status: data.data.send_accept_msg.booking_status,\r\n                        payment_type: data.data.send_accept_msg?.payment_type || \"\",\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n    };\r\n\r\n    render() {\r\n        const { ctob_billRef,ctob_shotcode,mpeas_payment_callback,base_price,extra_price,booking, booking_category, booking_provider, booking_user, payment_type, booking_status } = this.state;\r\n        console.log(\"Invoice -> render -> booking_status\", booking_status)\r\n        console.log(\"Invoice -> render -> mpeas_payment_callback\", mpeas_payment_callback)\r\n        console.log(\"Invoice -> render -> payment_option\", payment_type)\r\n\r\n        return (\r\n            <div className=\" col-xs-12 col-md-12 col-sm-12 invoice_body_color  \" >\r\n                <div className=\"col-xs-12 col-md-12 col-sm-12 col-lg-6 main_content mx-lg-auto\">\r\n                    <div className=\"invoice_header mt-1\">\r\n                        <div className={detectMobile.isMobile() ? \"d-none\" : \"\"}>\r\n                            <a href=\"/bookings\">\r\n                                <Tooltip placement=\"left\" title=\"Back to Booking\">\r\n                                    <Icon className=\"ml-2 cursor_point\" type=\"arrow-left\" style={{ fontSize: \"26px\" }} />\r\n                                </Tooltip>\r\n                            </a>\r\n                        </div>\r\n                        <div>\r\n                            <img src={main} alt={'gigzzy'} className='w-50x object_fit cursor_point' />\r\n                        </div>\r\n                        <div className=\"invoice_info\">\r\n                            <div>INVOICE NO <b>{booking[0] ? booking[0].booking_ref : \"\"}</b></div>\r\n                            <div> <small>{booking[0] ? booking[0].booking_date : \"\"}</small></div>\r\n                            <div className=\"py-2\">\r\n                                <Tag color=\"green\">\r\n                                    {payment_status[this.state.booking_status]}\r\n                                </Tag>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className={ (booking_status == 50 || mpeas_payment_callback == true)  && payment_type == \"c2b\" ? \"jumbotron p-1 mb-3 mx-3\" : \"d-none\"}>\r\n                        <Suspense fallback={\r\n                            <div class=\"spinner-border text-success\" role=\"status\">\r\n                                <span class=\"sr-only\">Loading...</span>\r\n                            </div>\r\n                        }>\r\n                            <C2B_CONTENT BusinessNumber={ctob_shotcode} AmountNumber={ctob_billRef} Amount={mpeas_payment_callback ? extra_price : base_price} />\r\n                        </Suspense>\r\n                    </div>\r\n                    <div className=\"user_batch mx-3\">\r\n                        <p><b>{booking_user[0] ? booking_user[0]?.name : \"\"}</b></p>\r\n                        <p>Thanks for using gigzzy.</p>\r\n                    </div>\r\n                    <div className=\"total_fare\">\r\n                        <h5>TOTAL COST</h5>\r\n                        <h1><small></small>{booking[0] ? booking[0].total : \"\"}</h1>\r\n                        {/* <h6>TOTAL HOURS : asd</h6> */}\r\n                    </div>\r\n                    <div className=\"fare_estimation col-xs-12 col-md-12 col-sm-12 nopad d-print-block d-md-flex\">\r\n                        <div className=\"fare_breakup mr-sm-3\">\r\n                            <p className=\"title\">Fare Breakup</p>\r\n                            <ul>\r\n                                <li>\r\n                                    <label>Base Price</label>\r\n                                    <span>{booking[0] ? booking[0].base_price : \"\"}</span>\r\n                                </li>\r\n                                {/* <li>\r\n                                            <label>Hour Fare</label>\r\n                                            <span>ad</span>\r\n                                        </li> */}\r\n                                <li>\r\n                                    <label>Extra Price </label>\r\n                                    <span>{booking[0] ? booking[0].extra_price : \"\"}</span>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                        <div className=\"tax_breakup \">\r\n                            <p className=\"title\">Service Breakup</p>\r\n                            <ul>\r\n                                <li>\r\n                                    <label className=\"d-flex align-items-center\">\r\n                                        Service Fee\r\n                                        <Tooltip placement=\"right\" title={`${booking[0]?.service_fee} %`}>\r\n                                            <Icon className=\"ml-2 cursor_point\" type=\"info-circle\" />\r\n                                        </Tooltip>\r\n\r\n                                        <span className=\"ml-auto\">\r\n                                            {booking[0] ? booking[0].admin_fee : \"\"}\r\n                                        </span>\r\n                                    </label>\r\n                                </li>\r\n                                {/* <li>\r\n                                    <label>( added to your total fare)</label>\r\n                                </li> */}\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"booking_details col-xs-12 col-md-12 col-sm-12\">\r\n                        <p className=\"title\">Booking Details</p>\r\n                        <ul>\r\n                            <li>\r\n                                <label>Service Type</label>\r\n                                <span>{booking_category[0] ? booking_category[0].category_type === 1 ? booking_category[0].category_name : booking_category[0].subCategory_name : ''}</span>\r\n                            </li>\r\n                            <li>\r\n                                <label>Booking Date</label>\r\n                                <span>{booking[0] ? booking[0].booking_date : \"\"}</span>\r\n                            </li>\r\n                            <li>\r\n                                <label>Scheduled Date</label>\r\n                                <span>{booking[0] ? booking[0].booking_date : \"\"}</span>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <div className=\"member_section col-xs-12 col-md-12 col-sm-12 nopad d-print-block d-md-flex\">\r\n                        <div className=\"user_details mr-sm-3\">\r\n                            <p className=\"title\">User Details</p>\r\n                            <ul>\r\n                                <li>\r\n                                    <label>Name</label>\r\n                                    <span>{booking_user[0] ? booking_user[0].name : \"\"}</span>\r\n                                </li>\r\n                                <li>\r\n                                    <label>Email</label>\r\n                                    <span>{booking_user[0] ? booking_user[0].email : \"\"}</span>\r\n                                </li>\r\n                                <li>\r\n                                    <label>Phone</label>\r\n                                    <span>{booking_user[0] ? booking_user[0].phone_number : \"\"}</span>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                        <div className=\"provider_details\">\r\n                            <p className=\"title\">Provider Details</p>\r\n                            <ul>\r\n                                <li>\r\n                                    <label>Name</label>\r\n                                    <span>{booking_provider[0] ? booking_provider[0].name : \"\"}</span>\r\n                                </li>\r\n                                <li>\r\n                                    <label>Email</label>\r\n                                    <span>{booking_provider[0] ? booking_provider[0].email : \"\"}</span>\r\n                                </li>\r\n                                <li>\r\n                                    <label>Phone</label>\r\n                                    <span>{booking_provider[0] ? booking_provider[0].phone_number : \"\"}</span>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"invoice_footer col-xs-12 m-3\">\r\n                        <hr />\r\n                        <p>\tThanks,</p>\r\n                        gigzzy Team\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withRouter(OndemandInvoice);\r\n"],"sourceRoot":""}